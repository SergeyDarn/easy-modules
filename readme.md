# Easy Git Modules

## Как работает библиотека

Исходный код полностью написан на го и скомпилирован в один бинарный файл. Для работы библиотеки достаточно скопировать этот бинарный файл в корень вашего проекта и настроить несколько переменных среды во втором файле (инструкция по установке ниже).

А по своей логике, библиотека считывает гит зависимости из `package.json` (или заданного в конфиге кастомного файла) и клонирует гит модули в заданную вами папку. Плюс предоставляет несколько дополнительных команд по работе с гит модулями.

## Установка

1. Скопировать в корень проекта файл `mod` из репозитория
2. Скопировать в корень проекта файл конфига `go.env`
3. Cоздать в корне проекта файл локального конфига `go.env.local` и не забыть добавить его в `.gitignore`
4. Задать настройки в файлах `go.env` и `go.env.local`
```.env
CONFIG_FILE="package.json"
MODULES_DIR="src/modules"
SSH_KEY_PATH="/Users/user/.ssh/id_rsa"
SSH_KEY_PASSWORD=""
```
`CONFIG_FILE` - JSON файл, из которого получается список модулей для установки (используются поля на верхнем уровне `dependencies` и `devDependencies` - как в обычном `package.json`)<br>
`MODULES_DIR` - Папка, в которую устанавливаются модули. Не забудьте добавить ее в `.gitignore`<br>
`SSH_KEY_PATH` - Абсолютный(!) путь к вашему локальному приватному SSH ключу<br>
`SSH_KEY_PASSWORD` - Пароль к вашему локальному приватному SSH ключу<br>

SSH Ключ и пароль в конфиге прописывать обязательно если вы будете клонировать модули по SSH - без этого функционал работать не будет (пароль нужен только если задавали его при создании ssh ключа, по умолчанию он пустой).

Как узнать свой SSH ключ - зайти в папку `~/.ssh` и там будет файл по типу `id_rsa` или `id_ed25330` - это нужный нам приватный ssh ключ. Чтобы узнать его абсолютный путь, в той же папке пишем `pwd` и складываем результат вывода в консоли с именем файла, и прописываем это в файле конфига.

## Команды модуля
```shell
    ./mod -h # Вывести в консоль полный список команд модуля
    ./mod # Запустить установку модулей (параллельная по дефолту, каждый модуль проверяется отдельно и если в каком-то из модулей есть изменения - он пропускается)
    ./mod -parallel-install=false # Запустить установку модулей (не параллельно)
    ./mod -safe-install=false # Запустить установку модулей с предварительным удалением корневой папки модулей для переустановки (по умолчанию такого нет)

    ./mod -show-changed-modules=true # Запустить отдельную команду, чтобы посмотреть список модулей в которых есть локальные изменения в гите
```

## Примеры референсов на модули в конфиге

1. Просто Ssh ссылка на модуль 
2. Просто Https ссылка на модуль
3. Ветки (если в модуле в ветке что-то изменяется и коммитится, то без обновления референса в конфиге при инсталле все новые обновления подтянулся)
4. Тэги (используется регулярка `\d(\..*)+` для определения что это тэг)
5. Хэш коммита

```json
{
   "devDependencies": {
      "test": "git@github.com:SergeyDarn/test-module-js.git",
      "storefront-query-builder": "https://github.com/DivanteLtd/storefront-query-builder.git",
   },
   "dependencies": {
      "scrape-search-ai": "https://github.com/SergeyDarn/scrape-search-ai#dev",
      "magnific-popup": "git@github.com:SergeyDarn/Magnific-Popup.git#1.8.0",
      "Course_Bash": "git@github.com:SergeyDarn/Course_Bash-Programming.git#3a7a19020151b45a29896c9142723efe5b11a061",
   }
}
```
